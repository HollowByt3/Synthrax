#This config file creates the structure for our logs and pipes it to the main synthrax program

# Load required modules
module(load="omprog")

# Define a custom JSON template to ensure we get exactly what CyborgDB needs
template(name="CyborgJSON" type="list") {
    constant(value="{")
    constant(value="\"timestamp\":\"")     property(name="timereported" dateFormat="rfc3339")
    constant(value="\",\"hostname\":\"")    property(name="hostname")
    constant(value="\",\"app\":\"")         property(name="app-name")
    constant(value="\",\"severity\":\"")    property(name="syslogseverity-text")
    constant(value="\",\"message\":\"")     property(name="msg" format="json")
    constant(value="\"}\n") 
}

# Send everything to your C++ app, excluding the app's own logs to avoid loops
if ($programname != 'synthrax') then {
    action(type="omprog"
           binary="/usr/local/bin/synthrax"
           template="CyborgJSON")
}

